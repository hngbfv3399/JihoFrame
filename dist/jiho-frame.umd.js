(function(p,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(p=typeof globalThis<"u"?globalThis:p||self,b(p.JihoFrame={}))})(this,function(p){"use strict";let b={},v={},I=[],C=new WeakMap,J=new Set,N=!1;const T=[],z=[],F=new Map,O=[];function q(){if(N)return;N=!0;const t=Array.from(J);J.clear(),[...new Set(t)].forEach(n=>{try{n()}catch(r){console.error("JihoFrame: 업데이트 중 오류 발생:",r)}}),N=!1}function G(){J.size>0&&Promise.resolve().then(q)}function H(t){if(typeof t!="function"){console.warn("JihoFrame: jihoInit expects a function");return}T.push(t)}function P(t){if(typeof t!="function"){console.warn("JihoFrame: jihoMount expects a function");return}z.push(t)}function K(t,e){if(typeof t!="function"){console.warn("JihoFrame: jihoUpdate expects a function as first parameter");return}F.has(e)||F.set(e,[]),F.get(e).push(t)}function Q(t){if(typeof t!="function"){console.warn("JihoFrame: jihoUnMount expects a function");return}O.push(t)}function X(t){C.has(t)&&(C.get(t).forEach(n=>n()),C.delete(t))}function V(t,e){if(typeof t!="string")throw new Error("JihoFrame: State key must be a string");t in b||(b[t]=e,v[t]=new Set);const n={get value(){return b[t]},set value(r){b[t]!==r&&(b[t]=r,I.forEach(o=>J.add(o)),F.has(n)&&F.get(n).forEach(o=>J.add(o)),v[t].forEach(o=>J.add(o)),G())},get:()=>b[t],set:r=>{n.value=r},subscribe:(r,o=null)=>{if(typeof r!="function")return console.warn("JihoFrame: subscribe expects a function"),()=>{};v[t].add(r);const i=()=>v[t].delete(r);return o&&(C.has(o)||C.set(o,[]),C.get(o).push(i)),i}};return n.get._setter=n.set,n}function S(t,e=null){if(typeof t!="function")return console.warn("JihoFrame: subscribeState expects a function"),()=>{};I.push(t);const n=()=>{const r=I.indexOf(t);r>-1&&I.splice(r,1)};return e&&(C.has(e)||C.set(e,[]),C.get(e).push(n)),n}function Y(){return{...b}}function D(t){t?(delete b[t],v[t]&&v[t].clear()):(b={},Object.values(v).forEach(e=>e.clear()),v={})}function Z(t,e){if(typeof e!="function")return console.warn("JihoFrame: watchState callback must be a function"),()=>{};if(!v[t])return console.warn(`JihoFrame: State key "${t}" does not exist`),()=>{};const n=(r,o)=>{try{e(r,o,t)}catch(i){te(i,`watchState callback for ${t}`)}};return v[t].add(n),()=>v[t].delete(n)}function L(t,e){if(!Array.isArray(t))throw new Error("JihoFrame: combineStates expects an array of state objects");if(typeof e!="function")throw new Error("JihoFrame: combineStates expects a combiner function");const n=`combined_${Date.now()}_${Math.random()}`,r=()=>{const a=t.map(s=>s.value),u=e(...a);b[n]!==u&&(b[n]=u)};r();const o=t.map(a=>a.subscribe(r)),i=V(n,b[n]);return i.cleanup=()=>{o.forEach(a=>a()),D(n)},i}function ee(t,e){if(!Array.isArray(t))throw new Error("JihoFrame: computedState expects an array of dependencies");if(typeof e!="function")throw new Error("JihoFrame: computedState expects a computer function");return L(t,e)}function te(t,e="Unknown"){var n,r;console.error(`JihoFrame Error in ${e}:`,t),typeof window<"u"&&((r=(n=window.process)==null?void 0:n.env)==null?void 0:r.NODE_ENV)==="development"&&console.trace()}const ne=(t={})=>{const{left:e=null,center:n=null,right:r=null,sticky:o=!0,blur:i=!1,transparent:a=!1,height:u=60,style:s={},...l}=t;return{div:{style:{display:"grid",gridTemplateColumns:"1fr 2fr 1fr",alignItems:"center",height:`${u}px`,padding:"0 1rem",background:a?"transparent":i?"rgba(255,255,255,0.8)":"#ffffff",backdropFilter:i?"blur(10px)":"none",borderBottom:a?"none":"1px solid #e0e0e0",position:o?"sticky":"relative",top:o?0:"auto",zIndex:100,transition:"all 0.3s ease",...s},"data-jiho-layout":"header",children:[{div:{style:{display:"flex",alignItems:"center",justifyContent:"flex-start"},children:e?Array.isArray(e)?e:[e]:[]}},{div:{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:n?Array.isArray(n)?n:[n]:[]}},{div:{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"0.5rem"},children:r?Array.isArray(r)?r:[r]:[]}}]}}},re=(t={})=>{const{items:e=[],direction:n="horizontal",position:r="bottom",style:o="pills",activeIndex:i=0,onChange:a=()=>{},...u}=t,s=()=>{const f={display:"flex",gap:"0.5rem",padding:"0.75rem",background:"#ffffff",borderRadius:o==="pills"?"2rem":"0.5rem",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"};return n==="vertical"&&(f.flexDirection="column"),r==="bottom"&&(f.position="fixed",f.bottom="1rem",f.left="50%",f.transform="translateX(-50%)"),f},l=(f,c)=>{const d={padding:"0.5rem 1rem",borderRadius:o==="pills"?"1.5rem":"0.25rem",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem",fontWeight:c?"600":"400",textDecoration:"none"};return c?(d.background="#007bff",d.color="#ffffff"):(d.background="transparent",d.color="#666"),d};return{nav:{style:s(),"data-jiho-layout":"nav","data-nav-style":o,children:e.map((f,c)=>({div:{style:l(c,c===i),event:{onClick:()=>a(c,f)},children:[f.icon&&{span:{text:f.icon,style:{fontSize:"1.2rem"}}},f.label&&{span:{text:f.label}}].filter(Boolean)}}))}}},oe=(t={})=>{const{title:e=null,subtitle:n=null,actions:r=null,children:o=[],padding:i="normal",background:a="default",...u}=t,s={none:"0",tight:"1rem",normal:"1.5rem",loose:"2.5rem"},l={default:{background:"transparent"},card:{background:"#ffffff",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #f0f0f0"},gradient:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#ffffff"}};return{section:{style:{padding:s[i],marginBottom:"1rem",...l[a],...u.style},"data-jiho-layout":"section",children:[(e||n||r)&&{div:{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(e||n)&&{div:{children:[e&&{h2:{text:e,style:{margin:0,fontSize:"1.5rem",fontWeight:"600",color:"inherit"}}},n&&{p:{text:n,style:{margin:"0.25rem 0 0 0",fontSize:"0.9rem",opacity:.7,color:"inherit"}}}].filter(Boolean)}},r&&{div:{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:Array.isArray(r)?r:[r]}}].filter(Boolean)}},...o].filter(Boolean)}}},ie=(t={})=>{const{cols:e="auto",gap:n="1rem",minItemWidth:r="250px",children:o=[],responsive:i=!0,...a}=t;return{div:{style:{display:"grid",gridTemplateColumns:(()=>e==="auto"?`repeat(auto-fit, minmax(${r}, 1fr))`:e==="fit"?`repeat(auto-fill, minmax(${r}, 1fr))`:i?`repeat(auto-fit, minmax(max(${r}, ${100/e}%), 1fr))`:`repeat(${e}, 1fr)`)(),gap:n,width:"100%",...a.style},"data-jiho-layout":"grid","data-grid-cols":e,children:o}}},ae=(t={})=>{const{text:e="",type:n="elevated",color:r="primary",size:o="medium",disabled:i=!1,fullWidth:a=!1,startIcon:u=null,endIcon:s=null,onClick:l=()=>{},...f}=t,c={primary:{main:"#007bff",contrast:"#ffffff",hover:"#0056b3"},secondary:{main:"#6c757d",contrast:"#ffffff",hover:"#545b62"},success:{main:"#28a745",contrast:"#ffffff",hover:"#1e7e34"},danger:{main:"#dc3545",contrast:"#ffffff",hover:"#c82333"},warning:{main:"#ffc107",contrast:"#000000",hover:"#e0a800"}},d={small:{padding:"6px 12px",fontSize:"14px",height:"32px"},medium:{padding:"10px 20px",fontSize:"16px",height:"40px"},large:{padding:"14px 28px",fontSize:"18px",height:"48px"}},y=(g,w)=>{const U={border:"none",borderRadius:"4px",cursor:i?"not-allowed":"pointer",transition:"all 0.2s ease",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",opacity:i?.6:1,outline:"none",textDecoration:"none",...d[o]};switch(g){case"elevated":return{...U,backgroundColor:w.main,color:w.contrast,boxShadow:"0 2px 4px rgba(0,0,0,0.2)","&:hover":i?{}:{backgroundColor:w.hover,boxShadow:"0 4px 8px rgba(0,0,0,0.3)"}};case"outlined":return{...U,backgroundColor:"transparent",color:w.main,border:`2px solid ${w.main}`,"&:hover":i?{}:{backgroundColor:`${w.main}10`,borderColor:w.hover}};case"text":return{...U,backgroundColor:"transparent",color:w.main,padding:d[o].padding,"&:hover":i?{}:{backgroundColor:`${w.main}10`}};case"icon":return{...U,backgroundColor:"transparent",color:w.main,padding:"8px",borderRadius:"50%",width:d[o].height,height:d[o].height,minWidth:d[o].height,"&:hover":i?{}:{backgroundColor:`${w.main}10`}};default:return U}},$=c[r]||c.primary,E={...y(n,$),width:a?"100%":"auto",...f.style},k=(g,w)=>g?typeof g=="string"?{span:{text:g,style:{fontSize:o==="small"?"16px":o==="large"?"24px":"20px"}}}:g:null,j=[];return u&&j.push(k(u)),e&&n!=="icon"&&j.push({span:{text:e}}),s&&j.push(k(s)),{button:{type:"button",disabled:i,style:E,"data-jiho-component":"Button","data-button-type":n,"data-button-color":r,"data-button-size":o,event:{onClick:g=>{!i&&l&&l(g)},onMouseEnter:g=>{!i&&f.onMouseEnter&&f.onMouseEnter(g)},onMouseLeave:g=>{!i&&f.onMouseLeave&&f.onMouseLeave(g)}},children:j,...f.attributes}}};function h(t,e="Unknown"){var n,r;console.error(`JihoFrame Error in ${e}:`,t),typeof window<"u"&&((r=(n=window.process)==null?void 0:n.env)==null?void 0:r.NODE_ENV)==="development"&&console.trace()}function m(t,e="function",n=null){try{return t()}catch(r){return h(r,e),n}}function ce(t,e,n){return e==="function"&&typeof t!="function"?(console.warn(`JihoFrame: Expected function in ${n}, got ${typeof t}`),!1):!0}function A(t,e,n="text"){if(typeof e=="function"){const r=()=>{const i=m(e,"bindValue update");i!==null&&(n==="checkbox"?t.checked=!!i:n==="radio"?t.checked=t.value===i:t.value=i)};r();const o=S(r);t._jihoUnsubscribers?t._jihoUnsubscribers.push(o):t._jihoUnsubscribers=[o],t.addEventListener("input",i=>{if(e._setter)try{n==="checkbox"?e._setter(i.target.checked):n==="radio"?i.target.checked&&e._setter(i.target.value):e._setter(i.target.value)}catch(a){h(a,"input event handler")}})}else n==="checkbox"?t.checked=!!e:n==="radio"?t.checked=t.value===e:t.value=e}function B(t,e){t._jihoUnsubscribers?t._jihoUnsubscribers.push(e):t._jihoUnsubscribers=[e]}function se(t,e){if(typeof e=="function"){const n=()=>{const o=m(e,"text update");o!==null&&(t.textContent=o)};n();const r=S(n);B(t,r)}else e!==void 0&&(t.textContent=e)}function ue(t,e){if(e&&typeof e=="object")try{Object.assign(t.style,e)}catch(n){h(n,"style application")}}function le(t,e){Array.isArray(e)?e.forEach(n=>{if(typeof n!="object"){console.warn("JihoFrame: Event object must be an object");return}W(t,n)}):e&&typeof e=="object"&&W(t,e)}function W(t,e){for(const[n,r]of Object.entries(e)){if(!ce(r,"function",`event ${n}`))continue;const o=n.toLowerCase().replace(/^on/,"");t.addEventListener(o,i=>{m(()=>r(i),`event handler ${n}`)})}}function _(t,e,n){n.forEach(r=>{if(r in e)try{t[r]=e[r]}catch(o){h(o,`setting attribute ${r}`)}})}function fe(t,e){Array.isArray(e)&&e.forEach(n=>{const r=document.createElement("option");typeof n=="string"?(r.value=n,r.textContent=n):n&&typeof n=="object"&&(r.value=n.value||"",r.textContent=n.label||n.value||""),t.appendChild(r)})}function de(t,e,n){switch(n){case"input":_(t,e,["type","checked","multiple","placeholder","required","name"]);const r=e.type||"text";A(t,e.value,r);break;case"textarea":_(t,e,["placeholder","required","rows","cols"]),A(t,e.value);break;case"select":_(t,e,["multiple","required","name"]),fe(t,e.options),A(t,e.value);break;case"checkbox":A(t,e.value,"checkbox");break;case"radio":A(t,e.value,"radio");break}}function he(t,e){if(typeof e=="function"){const n=()=>{const o=m(e,"disabled update");o!==null&&(t.disabled=!!o)};n();const r=S(n);B(t,r)}else e!==void 0&&(t.disabled=!!e)}function pe(t,e){if(typeof e=="function"){const n=()=>{const o=m(e,"show update");o!==null&&(t.style.display=o?"":"none")};n();const r=S(n);B(t,r)}else e===!1&&(t.style.display="none")}function be(t,e,n){if(!e||typeof e!="object"){console.warn("JihoFrame: Invalid options passed to applyAttributes");return}const{text:r,style:o,id:i,className:a,event:u,disabled:s,show:l}=e;se(t,r),ue(t,o),i&&(t.id=i),a&&(t.className=a),le(t,u),de(t,e,n),he(t,s),pe(t,l)}function me(t,e){var r;if(!e||typeof e!="object")return;const n=new Set(["text","style","id","className","event","children","if","elseIf","else","switch","case","default","option","type","value","checked","multiple","placeholder","required","for","each","show","disabled"]);if(Object.entries(e).forEach(([o,i])=>{if(!n.has(o))try{const a=typeof i=="function"?m(i,`child component ${o}`):i;if(!a||typeof a!="object")return;const u=Object.entries(a);if(u.length===0){console.warn(`JihoFrame: Empty object for child ${o}`);return}const[s,l]=u[0],f=x(s,l);f&&t.appendChild(f)}catch(a){h(a,`rendering child ${o}`)}}),Array.isArray(e.children)&&e.children.forEach((o,i)=>{try{if(!o||typeof o!="object"){console.warn(`JihoFrame: Invalid child at index ${i}`);return}const a=Object.entries(o);if(a.length===0){console.warn(`JihoFrame: Empty child object at index ${i}`);return}const[u,s]=a[0],l=x(u,s);l&&t.appendChild(l)}catch(a){h(a,`rendering child at index ${i}`)}}),(r=e.each)!=null&&r.list)try{const o=typeof e.each.list=="function"?m(e.each.list,"each list function"):e.each.list;Array.isArray(o)&&typeof e.each.render=="function"&&o.forEach((i,a)=>{try{const u=m(()=>e.each.render(i,a),`each render at index ${a}`);if(u&&typeof u=="object"){const s=Object.entries(u);if(s.length>0){const[l,f]=s[0],c=x(l,f);c&&t.appendChild(c)}}}catch(u){h(u,`each item rendering at index ${a}`)}})}catch(o){h(o,"each list processing")}}function M(t){t._jihoUnsubscribers&&(t._jihoUnsubscribers.forEach(e=>{try{e()}catch(n){h(n,"cleanup unsubscribe")}}),delete t._jihoUnsubscribers),Array.from(t.children).forEach(e=>M(e))}function ye(t,e){const r={JihoHeader:ne,JihoNav:re,JihoSection:oe,JihoGrid:ie,JihoButton:ae}[t];if(!r)return console.warn(`JihoFrame: Unknown JihoUI component: ${t}`),null;try{const o=r(e);if(o&&typeof o=="object"){const i=Object.entries(o);if(i.length>0){const[a,u]=i[0];return x(a,u)}}return null}catch(o){return h(o,`JihoUI component ${t}`),null}}function ge(t,e){const n=m(()=>t(e),`component ${t.name||"anonymous"}`);if(!n)return null;if(n.nodeType)return n;if(n.layout){const r=document.createElement("div");return r.style.display="contents",new R(r).update(n.layout),r}if(typeof n=="object"&&n!==null){const r=Object.entries(n);if(r.length>0){const[o,i]=r[0];return x(o,i)}}return console.warn("JihoFrame: Component returned invalid object"),null}function we(t){const e=m(t,"options function");if(!e)return null;if(typeof e=="object"&&e!==null){const n=Object.entries(e);if(n.length>0){const[r,o]=n[0];return x(r,o)}}return console.warn("JihoFrame: Options function returned invalid object"),null}function ve(t,e){if(typeof t!="string")return console.warn("JihoFrame: Tag must be a string, got:",typeof t),null;const n=document.createElement(t);return e&&(be(n,e,t),me(n,e)),n}function x(t,e){try{if(typeof t=="string"&&t.startsWith("Jiho"))return ye(t,e);if(typeof t=="function")return ge(t,e);if(typeof e=="function")return we(e);if(typeof e=="string"){const n=document.createElement(t);return n.textContent=e,n}return ve(t,e)}catch(n){return h(n,`createElement for tag ${t}`),null}}function xe(t,e){if(!Array.isArray(t)){console.warn("JihoFrame: Conditional block value must be an array");return}let n=document.createComment("condition-start"),r=document.createComment("condition-end"),o=null,i=[];e.appendChild(n),e.appendChild(r);const a=()=>{o&&(M(o),o.parentNode&&o.parentNode.removeChild(o),o=null),i.forEach(c=>{try{c()}catch(d){h(d,"conditional cleanup unsubscribe")}}),i=[]},u=(c,d)=>{const y=c.if??(d?!1:c.elseIf??c.else);return typeof y=="function"?m(y,"conditional condition"):y},s=(c,d)=>{if(!c||typeof c!="object")return console.warn("JihoFrame: Invalid conditional item"),{shouldContinue:!0,rendered:d};const y=Object.entries(c);if(y.length===0)return console.warn("JihoFrame: Empty conditional item"),{shouldContinue:!0,rendered:d};const[$,E]=y[0];if(!E||typeof E!="object")return{shouldContinue:!0,rendered:d};if(u(E,d)&&!d){const j=x($,E);if(j&&e.contains(r))return e.insertBefore(j,r),o=j,{shouldContinue:!1,rendered:!0}}return{shouldContinue:!0,rendered:d}},l=()=>{try{e.contains(r)||(r=document.createComment("condition-end"),e.appendChild(r)),a();let c=!1;for(const d of t){const y=s(d,c);if(c=y.rendered,!y.shouldContinue)break}}catch(c){h(c,"conditional block rerender")}},f=S(l);return i.push(f),l(),a}function Ce(t,e){if(!t||typeof t!="object"){console.warn("JihoFrame: Switch block must be an object");return}let n=document.createComment("switch-start"),r=document.createComment("switch-end"),o=null,i=[];e.appendChild(n),e.appendChild(r);const a=()=>{o&&(M(o),o.parentNode&&o.parentNode.removeChild(o),o=null),i.forEach(c=>{try{c()}catch(d){h(d,"switch cleanup unsubscribe")}}),i=[]},u=()=>typeof t.switch=="function"?m(t.switch,"switch value function"):t.switch,s=(c,d)=>{if(!c||typeof c!="object")return!1;if((c.case===d||c.default===!0)&&c.element&&typeof c.element=="object"){const y=Object.entries(c.element);if(y.length>0){const[$,E]=y[0],k=x($,E);if(k&&e.contains(r))return e.insertBefore(k,r),o=k,!0}}return!1},l=()=>{try{e.contains(r)||(r=document.createComment("switch-end"),e.appendChild(r)),a();const c=u();if(!Array.isArray(t.cases)){console.warn("JihoFrame: Switch cases must be an array");return}for(const d of t.cases)if(s(d,c))break}catch(c){h(c,"switch block rerender")}},f=S(l);return i.push(f),l(),a}class R{constructor(e){this.container=e,this.currentNodes=[],this.cleanupFunctions=[]}cleanup(){this.currentNodes.forEach(e=>{e&&e.parentNode&&(M(e),e.parentNode.removeChild(e))}),this.cleanupFunctions.forEach(e=>{try{e()}catch(n){h(n,"DOM updater cleanup")}}),this.currentNodes=[],this.cleanupFunctions=[]}processFunctionItem(e,n){const r=m(e,`layout function at index ${n}`);if(r&&typeof r=="object"){const o=Object.entries(r);if(o.length>0){const[i,a]=o[0],u=x(i,a);u&&(this.container.appendChild(u),this.currentNodes.push(u))}}}processObjectItem(e){const n=Object.entries(e);if(n.length>0){const[r,o]=n[0];if(r==="condition"&&Array.isArray(o)){const i=xe(o,this.container);i&&this.cleanupFunctions.push(i)}else if(r==="switchBlock"){const i=Ce(o,this.container);i&&this.cleanupFunctions.push(i)}else{const i=x(r,o);i&&(this.container.appendChild(i),this.currentNodes.push(i))}}}update(e){if(this.cleanup(),!Array.isArray(e)){console.warn("JihoFrame: Layout must be an array");return}e.forEach((n,r)=>{try{typeof n=="function"?this.processFunctionItem(n,r):n&&typeof n=="object"&&this.processObjectItem(n)}catch(o){h(o,`rendering layout item at index ${r}`)}})}}function Se(t,e){if(typeof t!="function")throw new Error("JihoFrame: App must be a function");if(!e||!e.appendChild)throw new Error("JihoFrame: Container must be a valid DOM element");T.forEach(s=>{try{s()}catch(l){h(l,"init callback")}});const n=new R(e);let r=[];const o=()=>{z.forEach(s=>{try{s()}catch(l){h(l,"mount callback")}})},i=()=>{try{const s=m(t,"app function");if(!s)return;if(!s.layout){console.warn("JihoFrame: App function must return an object with layout property");return}n.update(s.layout),o()}catch(s){h(s,"app rerender")}},a=S(i);r.push(a),i();const u=()=>{try{O.forEach(s=>{try{s()}catch(l){h(l,"unmount callback")}}),n.cleanup(),r.forEach(s=>{try{s()}catch(l){h(l,"app unsubscribe")}})}catch(s){h(s,"app cleanup")}};return window.addEventListener("beforeunload",u),u}p.combineStates=L,p.computedState=ee,p.createState=V,p.getStateSnapshot=Y,p.jihoInit=H,p.jihoMount=P,p.jihoUnMount=Q,p.jihoUpdate=K,p.renderApp=Se,p.resetState=D,p.subscribeState=S,p.unsubscribeAll=X,p.watchState=Z,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
